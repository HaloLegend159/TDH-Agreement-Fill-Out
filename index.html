<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TDH — One-Page Professional PDF</title>
<meta name="color-scheme" content="light dark" />
<style>
  :root{
    --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#9aa4b2; --border:#1f2937;
    --accent:#1f3a8a; --accent2:#0ea5e9; --radius:14px; --gap:14px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px 80px}
  .toolbar{position:sticky;top:0;z-index:10;backdrop-filter:blur(6px);
    background:color-mix(in oklab,var(--bg) 80%, transparent);
    display:flex;gap:8px;align-items:center;padding:12px 0 14px}
  .toolbar h1{margin:0;font-size:18px;font-weight:700;letter-spacing:.2px;margin-right:auto}
  button{border:1px solid var(--border);background:#0c1a34;color:var(--ink);
    padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
  button.primary{background:#143061}
  button:hover{filter:brightness(1.15)}
  .grid{display:grid;gap:var(--gap)}
  .two{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:16px}
  .panel h2{margin:0 0 10px;font-size:16px}
  label{display:block;color:var(--muted);font-size:12px;margin-bottom:6px}
  input, textarea, select{
    width:100%; background:#0a152b; color:var(--ink);
    border:1px solid var(--border); border-radius:10px; padding:10px 12px; outline:none;
    transition:border-color .2s, box-shadow .2s, background .2s
  }
  input:hover, textarea:hover, select:hover{ border-color:#334155; background:#0c1a33 }
  input:focus, textarea:focus, select:focus{ border-color:#60a5fa; box-shadow:0 0 0 3px rgba(96,165,250,.25)}
  textarea{min-height:80px;resize:vertical}
  .checks{display:flex;flex-wrap:wrap;gap:10px 16px}
  .checks label{display:inline-flex;align-items:center;gap:8px;margin:0}
  .muted{color:var(--muted);font-size:12px}
  .row{display:grid;gap:10px;grid-template-columns:180px 1fr;align-items:center}
  .logoPreview{display:flex;align-items:center;gap:10px}
  .logoPreview img{max-height:42px;border-radius:8px;border:1px solid var(--border)}
</style>
</head>
<body>
<div class="wrap">
  <div class="toolbar">
    <h1>One-Page Agreement PDF</h1>
    <div class="actions">
      <button id="loadExample" type="button" title="Fills with fake demo data">Load Example</button>
      <button id="clearForm" type="button">Clear</button>
      <button id="downloadPdf" type="button" class="primary"><strong>Download PDF</strong></button>
    </div>
  </div>

  <!-- HONEYPOT to discourage browser profile autofill -->
  <form style="position:absolute;left:-9999px;top:-9999px">
    <input type="text" autocomplete="username">
    <input type="password" autocomplete="new-password">
  </form>

  <form id="f" class="grid" autocomplete="off">
    <div class="panel">
      <h2>Branding (optional)</h2>
      <div class="grid two">
        <div>
          <label for="companyName">Company Name</label>
          <input id="companyName" name="companyName" type="text" placeholder="TDH Roofing & Siding" />
        </div>
        <div>
          <label for="companyPhone">Phone</label>
          <input id="companyPhone" name="companyPhone" type="text" placeholder="(555) 010-0000" />
        </div>
        <div>
          <label for="companyEmail">Email</label>
          <input id="companyEmail" name="companyEmail" type="text" placeholder="hello@example.com" />
        </div>
        <div>
          <label for="companyAddress">Address</label>
          <input id="companyAddress" name="companyAddress" type="text" placeholder="2513 River Rd Dr, Waterloo, NE 68069" />
        </div>
      </div>
      <div class="logoPreview" style="margin-top:10px">
        <div>
          <label for="logo">Logo (PNG/JPG)</label>
          <input id="logo" name="logo" type="file" accept="image/*" />
          <div class="muted">Optional. Keeps everything 1 page.</div>
        </div>
        <img id="logoImg" alt="" hidden />
      </div>
    </div>

    <div class="panel">
      <h2>Customer & Job</h2>
      <div class="grid two">
        <div><label for="custName">Customer Name</label><input id="custName" name="custName" type="text" /></div>
        <div><label for="custPhone">Phone</label><input id="custPhone" name="custPhone" type="text" /></div>
        <div><label for="address">Address</label><input id="address" name="address" type="text" /></div>
        <div><label for="claim">Claim # (optional)</label><input id="claim" name="claim" type="text" /></div>
      </div>
      <div style="margin-top:10px">
        <label>Scope</label>
        <div class="checks">
          <label><input type="checkbox" name="scope" value="Roofing">Roofing</label>
          <label><input type="checkbox" name="scope" value="Gutters">Gutters</label>
          <label><input type="checkbox" name="scope" value="Siding">Siding</label>
          <label><input type="checkbox" name="scope" value="Windows">Windows</label>
          <label><input type="checkbox" name="scope" value="Other">Other</label>
        </div>
      </div>
      <div style="margin-top:10px">
        <label for="summary">Summary of work (short)</label>
        <textarea id="summary" name="summary" placeholder="Tear-off 1 layer; install architectural shingles; replace drip edge; add 6 turtle vents; color: White."></textarea>
      </div>
      <div style="margin-top:10px">
        <label for="notes">Notes (optional)</label>
        <textarea id="notes" name="notes" placeholder="Crew access via east alley; protect landscaping; reset satellite dish."></textarea>
      </div>
    </div>

    <div class="panel">
      <h2>Payment & Dates</h2>
      <div class="grid two">
        <div><label for="amount">Agreed Amount</label><input id="amount" name="amount" type="text" placeholder="RCV + Approved Supplements / $xx,xxx" /></div>
        <div><label for="deposit">First Payment</label><input id="deposit" name="deposit" type="text" placeholder="ACV / $x,xxx" /></div>
        <div><label for="final">Final Payment</label><input id="final" name="final" type="text" placeholder="Balance on completion" /></div>
        <div><label for="date">Agreement Date</label><input id="date" name="date" type="date" /></div>
      </div>
      <div class="grid two" style="margin-top:10px">
        <div><label for="custSign">Customer (typed) Signature</label><input id="custSign" name="custSign" type="text" placeholder="e.g., Jordan Sample" /></div>
        <div><label for="repSign">Company Rep (typed) Signature</label><input id="repSign" name="repSign" type="text" placeholder="e.g., Taylor North" /></div>
      </div>
    </div>
  </form>
</div>

<!-- jsPDF loader with fallbacks -->
<script>
async function ensureJsPDFLoaded(){
  if (window.jspdf?.jsPDF) return true;
  const cdns = [
    "https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",
    "https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js",
    "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",
  ];
  for (const src of cdns){
    try {
      await new Promise((res, rej)=>{
        const s = document.createElement("script"); s.src = src;
        s.onload = res; s.onerror = rej; document.head.appendChild(s);
      });
      if (window.jspdf?.jsPDF) return true;
    } catch(e){}
  }
  alert("Couldn’t load PDF engine. Check your network.");
  return false;
}
</script>

<script>
/* Small utilities */
function toObj(form){
  const out={}; new FormData(form).forEach((v,k)=>{
    if(out[k]!==undefined){ if(!Array.isArray(out[k])) out[k]=[out[k]]; out[k].push(v); }
    else out[k]=v;
  }); return out;
}
function fill(form,data){
  for (const el of form.elements){
    if(!el.name) continue;
    const v=data[el.name]; if(v===undefined) continue;
    if(el.type==='checkbox') el.checked = Array.isArray(v) ? v.includes(el.value) : (v===true || v===el.value);
    else if(el.type==='radio') el.checked = (String(v)===el.value);
    else el.value = Array.isArray(v) ? v[0] : v;
  }
}

/* Logo file → dataURL preview */
const logoInput = document.getElementById('logo');
const logoImg = document.getElementById('logoImg');
let logoDataUrl = null;
logoInput.addEventListener('change', ()=>{
  const f = logoInput.files?.[0];
  if(!f) { logoDataUrl=null; logoImg.hidden=true; logoImg.removeAttribute('src'); return; }
  const r=new FileReader();
  r.onload=()=>{ logoDataUrl=r.result; logoImg.src=logoDataUrl; logoImg.hidden=false; };
  r.readAsDataURL(f);
});
</script>

<script>
/* Main PDF generation — clean single page */
document.getElementById('downloadPdf').addEventListener('click', async ()=>{
  if(!(await ensureJsPDFLoaded())) return;
  const { jsPDF } = window.jspdf;
  const d = toObj(document.getElementById('f'));

  const doc = new jsPDF({ unit:'in', format:'letter' }); // 8.5 x 11
  const W=8.5, H=11, M=0.5;

  // Helpers
  const set = (font="helvetica", weight="normal", size=10) => { doc.setFont(font, weight); doc.setFontSize(size); };
  const line = (x1,y1,x2,y2,w=0.015)=>{ doc.setLineWidth(w); doc.line(x1,y1,x2,y2); };
  const section = (title, y)=>{ set("helvetica","bold",12); doc.text(title, M, y); line(M, y+0.06, W-M, y+0.06, 0.012); return y+0.22; };
  const kv = (x,y,key,val,wKey=1.25, wVal=2.5)=>{
    set("helvetica","bold",10); doc.text(key, x, y);
    set("helvetica","normal",10);
    const txt = Array.isArray(val) ? val.join(", ") : (val||"");
    const lines = doc.splitTextToSize(txt, wVal);
    doc.text(lines, x+wKey, y);
    return y + 0.22 * Math.max(1, lines.length);
  };
  const bullets = (x,y,arr,w=3.8)=>{
    set("helvetica","normal",10);
    let yy=y;
    (arr||[]).forEach(item=>{
      const lines = doc.splitTextToSize(String(item), w-0.2);
      doc.text("•", x, yy);
      doc.text(lines, x+0.18, yy);
      yy += 0.22*lines.length;
    });
    return yy;
  };

  // Header band
  doc.setFillColor(20,35,75); // deep blue
  doc.rect(0,0,W,1.0,"F");
  if (logoDataUrl){
    try { doc.addImage(logoDataUrl, "PNG", M, 0.2, 1.2, 0.6); } catch(e){}
  }
  set("helvetica","bold",16);
  doc.setTextColor(255,255,255);
  doc.text(d.companyName || "Work Agreement", logoDataUrl ? (M+1.35) : M, 0.55);
  set("helvetica","normal",9);
  const sub = [d.companyAddress, d.companyPhone, d.companyEmail].filter(Boolean).join("   •   ");
  if (sub) doc.text(sub, logoDataUrl ? (M+1.35) : M, 0.82);
  doc.setTextColor(0,0,0);

  // Body
  let y = 1.15;

  // Customer & Job (two columns)
  y = section("Customer & Job", y);
  let xL = M, xR = W/2 + 0.1;

  y = Math.max(
    kv(xL, y, "Customer:", d.custName),
    kv(xR, y, "Phone:", d.custPhone),
  );
  y = Math.max(
    kv(xL, y, "Address:", d.address, 1.25, 3.1),
    kv(xR, y, "Claim #:", d.claim),
  );

  // Scope Summary block
  y += 0.08;
  set("helvetica","bold",10); doc.text("Scope:", M, y); set("helvetica","normal",10);
  const scopeSel = [].concat(d.scope||[]);
  const scopeLine = scopeSel.length ? `(${scopeSel.join(", ")})` : "";
  doc.text(scopeLine, M+0.5, y);
  y += 0.2;

  // Summary box
  doc.setDrawColor(220); doc.setFillColor(246); // subtle box
  doc.roundedRect(M, y, W-2*M, 1.75, 0.08, 0.08, "FD");
  set("helvetica","normal",10);
  const summary = (d.summary||"").trim() || "—";
  const sumLines = doc.splitTextToSize(summary, (W-2*M)-0.3);
  doc.text(sumLines.slice(0,8), M+0.15, y+0.25);
  y += 1.85;

  // Notes (optional)
  y = section("Notes", y);
  const notes = (d.notes||"").trim();
  if (notes){
    y = bullets(M, y, doc.splitTextToSize(notes, W-2*M));
  } else {
    set("helvetica","italic",10); doc.text("None", M, y); y+=0.22;
  }

  // Payment
  y = section("Payment", y+0.08);
  y = Math.max(
    kv(M, y, "Agreed Amount:", d.amount, 1.3, 2.5),
    kv(W/2+0.1, y, "First Payment:", d.deposit, 1.25, 2.4)
  );
  y = kv(M, y, "Final Payment:", d.final, 1.3, 6.4);

  // Signatures row near bottom
  const sigY = H - 1.2;
  set("helvetica","bold",10); doc.text("Agreement Date:", M, sigY-0.45);
  set("helvetica","normal",10); doc.text((d.date||"").replace(/^(\d{4})-(\d{2})-(\d{2})$/, "$2/$3/$1"), M+1.15, sigY-0.45);

  // Customer signature
  set("helvetica","bold",10); doc.text("Customer (typed) Signature", M, sigY-0.1);
  line(M, sigY, W/2-0.2, sigY);
  set("helvetica","normal",10); doc.text(d.custSign||"", M+0.05, sigY-0.02);

  // Rep signature
  set("helvetica","bold",10); doc.text("Company Rep (typed) Signature", W/2+0.2, sigY-0.1);
  line(W/2+0.2, sigY, W-M, sigY);
  set("helvetica","normal",10); doc.text(d.repSign||"", W/2+0.25, sigY-0.02);

  // Footer line
  doc.setDrawColor(220); line(M, H-0.55, W-M, H-0.55, 0.01);
  set("helvetica","normal",8);
  const footLeft = d.companyName || "Prepared by";
  const footRight = new Date().toLocaleString();
  doc.text(footLeft, M, H-0.35);
  doc.text(footRight, W-M, H-0.35, {align:"right"});

  const filename = `Agreement_${(d.custName||'Client').replace(/\s+/g,'_')}.pdf`;
  doc.save(filename);
});
</script>

<script>
/* Demo data (fake) + clear */
const f = document.getElementById('f');
const example = {
  companyName:"TDH Roofing & Siding",
  companyPhone:"(555) 010-7744",
  companyEmail:"hello@tdh-example.com",
  companyAddress:"2513 River Rd Dr, Waterloo, NE 68069",
  custName:"Jordan Sample",
  custPhone:"(555) 010-2299",
  address:"7425 Oak Meadow Ct, Prairie City, NE 68000",
  claim:"PRM-2045-XS9",
  scope:["Roofing","Gutters","Siding"],
  summary:"Tear-off 1 layer; install architectural shingles (Landmark). Drip edge + gutter apron (white). Add 6 turtle vents; ridge cap high-profile. Replace gutters 6\" w/ 3×4 downspouts; color white. Protect landscaping; reset satellite.",
  notes:"Crew access via east alley.\nMag roller sweep.\nRemove all debris daily.",
  amount:"RCV + Approved Supplements",
  deposit:"ACV at material delivery",
  final:"Balance on completion",
  date:"",
  custSign:"Jordan Sample",
  repSign:"Taylor North"
};
document.getElementById('loadExample').addEventListener('click', ()=> fill(f, example));
document.getElementById('clearForm').addEventListener('click', ()=> f.reset());
</script>
</body>
</html>
